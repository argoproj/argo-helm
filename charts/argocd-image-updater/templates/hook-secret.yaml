{{- with index .Values "hooks" }}
{{- if and .enabled (ne .secret.apiKey "") -}}
apiVersion: v1
kind: Secret
metadata:
  name: "argocd-image-updater-secret"
  labels:
    {{- include "argocd-image-updater.labels" $ | nindent 4 }}
  annotations:
    "helm.sh/hook": pre-install,pre-upgrade
    "helm.sh/hook-weight": "-5"
    "helm.sh/hook-delete-policy": hook-succeeded
    "helm.sh/hook-delete-policy": before-hook-creation
type: Opaque
data:
  argocd.token: {{ index .secret "apiKey" | b64enc }}
{{- end }}
{{- end }}
