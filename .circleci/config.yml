version: 2.1
jobs:
  lint:
    docker:
      - image: gcr.io/kubernetes-charts-ci/test-image:v3.0.1
    steps:
      - checkout
      - run: ct lint --config .circleci/chart-testing.yaml
  publish:
    docker:
      - image: gcr.io/kubernetes-charts-ci/test-image:v3.0.1
    steps:
      - checkout
      - run: stat ./scripts/publish.sh
      - run:
          command: ./scripts/publish.sh
          environment:
            - GIT_PUSH: "true"
workflows:
  version: 2
  workflow:
    jobs:
      - lint
      - publish:
          requires:
            - lint
          filters:
            branches:
              only:
                - circleci
